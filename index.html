<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indonesia KTP Generator - Dynamic Provinces & Regencies</title>
    <script type='text/javascript' src='./data.js'></script>
    <style>
        @font-face {
            font-family: ocr;
            src: url(ocraextended.ttf);
        }

        html {
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        body {
            background-color: #1d86a4;
        }

        *,
        *:before,
        *:after {
            -webkit-box-sizing: inherit;
            -moz-box-sizing: inherit;
            box-sizing: inherit;
        }

        .parentBox {
            height: 96vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .box {
            height: 600px;
            width: 600px;
            background-image: url("assets/ktp_template_region.jpg");
            background-repeat: no-repeat;
            background-size: cover;
            /* position: relative; */
            transform: scale(1);
        }

        input {
            position: absolute;
            background: transparent;
            border: none;
            font-family: Arial;
            font-size: 12px;
            font-weight: normal;
            text-transform: uppercase;
            transform: skew(0deg, -1.3deg);
            color: transparent;
            text-shadow: 0 0 1px rgba(0, 0, 0, 1);
        }

        .nik {
            font-family: ocr;
            left: 206px;
            top: 201px;
            font-size: 20px;
        }

        .name {
            left: 220px;
            top: 233px;
        }

        .region {
            left: 220px;
            top: 246px;
        }

        .dob {
            left: 300px;
            top: 245px;
        }

        .jenis {
            left: 220px;
            top: 260px;
        }

        .golDarah {
            left: 390px;
            top: 257px;
        }

        .alamat {
            left: 220px;
            top: 273px;
        }

        .rt {
            left: 220px;
            top: 286px;
        }

        .kel {
            left: 220px;
            top: 300px;
        }

        .kec {
            left: 220px;
            top: 313px;
        }

        .agama {
            left: 220px;
            top: 326px;
        }

        .status {
            left: 220px;
            top: 338px;
        }

        .pek {
            left: 221px;
            top: 351px;
        }

        .kew {
            left: 221px;
            top: 365px;
        }

        .ber {
            left: 221px;
            top: 378px;
        }

        .photoContainer {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            left: 422px;
            top: 215px;
            transform: skew(0deg, -1.3deg);
        }

        .profileimg {
            height: 135px;
            width: 107px;
            filter: blur(1px);
        }

        .scaleBox {
            position: fixed;
            right: 120px;
            top: 20px;
            z-index: 1000;
            display: flex; 
            flex-direction: column;
            gap: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            max-width: 250px;
            min-width: 200px;
        }

        .scaleBox > input {
            width: 100%; 
            padding: 5px;
            margin: 5px 0;
        }

        .regenerateBtn {
            padding: 8px 15px;
            background: #1d86a4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-size: 12px;
            transition: background 0.3s;
            width: 100%;
            margin-top: 5px;
        }

        .regenerateBtn:hover {
            background: #156a80;
        }

        .controlLabel {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            font-size: 14px;
            text-align: center;
        }

        .provinceInfo {
            position: fixed;
            left: 30px;
            top: 30px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-weight: bold;
            color: #333;
        }

        .provinceInfo .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .provinceInfo .value {
            font-size: 14px;
            color: #1d86a4;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .scaleBox {
                right: 10px;
                bottom: 10px;
                max-width: 180px;
                min-width: 150px;
                padding: 10px;
            }
            
            .provinceInfo {
                left: 10px;
                top: 10px;
                padding: 10px;
                max-width: 200px;
            }
            
            .regenerateBtn {
                font-size: 11px;
                padding: 6px 10px;
            }
        }

        @media (max-width: 480px) {
            .scaleBox {
                right: 5px;
                bottom: 5px;
                max-width: 150px;
                min-width: 120px;
            }
            
            .provinceInfo {
                left: 5px;
                top: 5px;
                max-width: 180px;
            }
        }

        .province {
            font-family: ocr;
            left: 190px;
            top: 165px;
            font-size: 20px;
            text-align: center;
        }

        .regency {
            font-family: ocr;
            left: 190px;
            top: 180px;
            font-size: 20px;
            text-align: center;
        }
    </style>
</head>

<body>
    <div class="parentBox">
        <div class="provinceInfo">
            <div class="label">Current Province & Regency:</div>
            <div class="value" id="provinceDisplay">Loading...</div>
        </div>
        <div id="ktp" class="box">
            <div class="photoContainer">
                <img class="profileimg" src="">
                <div class="shrtdisc">
                    <input type="text" class="region2" value="">
                    </br>
                    <input type="text" class="tem" value="">
                </div>
            </div>
            <input type="text" class="province" value="">    
            <input type="text" class="regency" value="">    
            <input type="text" class="nik" value="">
            <input type="text" class="name" value="">
            <input type="text" class="region">
            <input type="text" class="dob">
            <input type="text" class="jenis" value="">
            <input type="text" class="golDarah" value="">
            <input type="text" class="alamat" value="">
            <input type="text" class="rt" value="">
            <input type="text" class="kel" value="">
            <input type="text" class="kec" value="">
            <input type="text" class="agama" value="">
            <input type="text" class="status" value="">
            <input type="text" class="pek" value="">
            <input type="text" class="kew" value="">
            <input type="text" class="ber" value="">
        </div>
        <div class="scaleBox">
            <div class="controlLabel">Scale</div>
            <input type="range" id="scale" min="0.25" max="3" step="0.01" value="1">
            <button class="regenerateBtn" onclick="generateNewKTP()">Generate New KTP</button>
        </div>
    </div>
    <script>
        function randomIntFromInterval(min, max) { // min and max included 
            return Math.floor(Math.random() * (max - min + 1) + min);
        }

        function generateDOB() {
            // Calculate the minimum(78 yrs age) and maximum(18 yrs age) timestamps for the desired age range
            const minTimestamp = Date.now() - (78 * 365 * 24 * 60 * 60 * 1000);
            const maxTimestamp = Date.now() - (18 * 365 * 24 * 60 * 1000);
            // Generate a random timestamp between the minimum and maximum
            const randomTimestamp = Math.floor(Math.random() * (maxTimestamp - minTimestamp + 1)) + minTimestamp;
            // Create a new Date object using the random timestamp
            const dob = new Date(randomTimestamp);
            return dob;
        }

        function generateNIK(gender, provinceCode, regencyCode) {
            const dobDate = generateDOB();
            const randomBirthYear = dobDate.getFullYear().toString().substr(-2).padStart(2, '0');
            const randomBirthMonth = (dobDate.getMonth() + 1).toString().padStart(2, '0');
            const randomBirthDay = (dobDate.getDate() + (gender == 'male' ? 0 : 40)).toString().padStart(2, '0');
            const randomSerialNumber = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            const nik = `${provinceCode}${regencyCode}${randomBirthDay}${randomBirthMonth}${randomBirthYear}${randomSerialNumber}`;
            return { nik, dob: dobDate };
        }

        function formatDate(date) {
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0'); 
            const year = date.getFullYear();
            return `${day}-${month}-${year}`;
        }

        function getRandomBloodType() {
            const bloodTypes = ['A', 'B', 'AB', 'O'];
            const rhesus = ['+', '-'];
            return bloodTypes[Math.floor(Math.random() * bloodTypes.length)] + 
                   rhesus[Math.floor(Math.random() * rhesus.length)];
        }

        function getRandomReligion() {
            const religions = ["ISLAM", "KRISTEN", "KATOLIK", "HINDU", "BUDDHA", "KHONGHUCU"];
            return religions[Math.floor(Math.random() * religions.length)];
        }

        function getRandomMaritalStatus() {
            const statuses = ["BELUM KAWIN", "KAWIN", "CERAI HIDUP", "CERAI MATI"];
            return statuses[Math.floor(Math.random() * statuses.length)];
        }

        function getRandomOccupation() {
            const occupations = [
                "PEGAWAI NEGERI SIPIL", "TNI", "POLRI", "PERDAGANGAN", "PETANI/PEKEBUN",
                "PETERNAK", "NELAYAN/PERIKANAN", "INDUSTRI", "KONSTRUKSI", "TRANSPORTASI",
                "KARYAWAN SWASTA", "KARYAWAN BUMN", "KARYAWAN BUMD", "KARYAWAN HONORER",
                "BURUH HARIAN LEPAS", "BURUH TANI/PERKEBUNAN", "BURUH NELAYAN/PERIKANAN",
                "BURUH PETERNAKAN", "PEMBANTU RUMAH TANGGA", "TUKANG CUKUR", "TUKANG LISTRIK",
                "TUKANG BATU", "TUKANG KAYU", "TUKANG SOL SEPATU", "TUKANG LAS/PANDAI BESI",
                "TUKANG JAHIT", "TUKANG GIGI", "PENATA RIAS", "PENATA BUSANA", "PENATA RAMBUT",
                "MEKANIK", "SENIMAN", "TABIB", "PARAJI", "PERANCANG BUSANA", "PENTERJEMAH",
                "IMAM MASJID", "PENDETA", "PASTOR", "WARTAWAN", "USTADZ/MUBALIGH", "JURU MASAK",
                "PROMOTOR ACARA", "ANGGOTA DPR-RI", "ANGGOTA DPD", "ANGGOTA BPK", "PRESIDEN",
                "WAKIL PRESIDEN", "ANGGOTA MAHKAMAH KONSTITUSI", "ANGGOTA KABINET KEMENTERIAN",
                "DUTA BESAR", "GUBERNUR", "WAKIL GUBERNUR", "BUPATI", "WAKIL BUPATI", "WALIKOTA",
                "WAKIL WALIKOTA", "ANGGOTA DPRD PROVINSI", "ANGGOTA DPRD KABUPATEN/KOTA",
                "DOSEN", "GURU", "PILOT", "PENGACARA", "NOTARIS", "ARSITEK", "AKUNTAN",
                "KONSULTAN", "DOKTER", "BIDAN", "PERAWAT", "APOTEKER", "PSIKIATER/PSIKOLOG",
                "PELAJAR/MAHASISWA", "MENGURUS RUMAH TANGGA", "SUDAH TIDAK BEKERJA", "BELUM/TIDAK BEKERJA"
            ];
            return occupations[Math.floor(Math.random() * occupations.length)];
        }

        // Generate random Indonesian data
        function generateNewKTP() {
            try {
                // Check if data is loaded
                if (typeof indonesiaProvinces === 'undefined' || typeof userImages === 'undefined') {
                    console.error('Data not loaded properly');
                    document.getElementById("provinceDisplay").textContent = "Error: Data not loaded";
                    return;
                }

                var selectedProvince = getRandomProvince();
                var selectedRegency = getRandomRegency(selectedProvince);
                var rndInt = randomIntFromInterval(0, userImages.length - 1);
                var singleUserSource = userImages[rndInt];
                var generatedNIK = generateNIK(singleUserSource.gender, selectedProvince.code, selectedRegency.code);
                var randomName = getRandomIndonesianName();
                var randomAddress = getRandomIndonesianAddress();

                // Update province display
                document.getElementById("provinceDisplay").textContent = selectedProvince.name + " - " + selectedRegency.name;

                document.getElementsByClassName("profileimg")[0].src = "./" + singleUserSource.source
                document.getElementsByClassName("nik")[0].value = generatedNIK.nik
                document.getElementsByClassName("name")[0].value = randomName.toUpperCase()
                document.getElementsByClassName("region")[0].value = "SINGARAJA" + ","
                document.getElementsByClassName("dob")[0].value = formatDate(generatedNIK.dob)
                document.getElementsByClassName("jenis")[0].value = singleUserSource.gender == "male" ? "LAKI-LAKI" : "PEREMPUAN"
                document.getElementsByClassName("golDarah")[0].value = getRandomBloodType()
                document.getElementsByClassName("alamat")[0].value = randomAddress.substring(0, 25).toUpperCase()
                document.getElementsByClassName("rt")[0].value = String(Math.floor(Math.random() * 20) + 1).padStart(3, '0') + "/" + String(Math.floor(Math.random() * 20) + 1).padStart(3, '0')
                document.getElementsByClassName("kel")[0].value = selectedRegency.name
                document.getElementsByClassName("kec")[0].value = selectedRegency.name
                document.getElementsByClassName("agama")[0].value = getRandomReligion()
                document.getElementsByClassName("status")[0].value = getRandomMaritalStatus()
                document.getElementsByClassName("pek")[0].value = getRandomOccupation()
                document.getElementsByClassName("kew")[0].value = "WNI"
                document.getElementsByClassName("ber")[0].value = "SEUMUR HIDUP"

                document.getElementsByClassName("province")[0].value = selectedProvince.name.toUpperCase();
                document.getElementsByClassName("regency")[0].value = selectedRegency.name.toUpperCase();
            } catch (error) {
                console.error('Error generating KTP:', error);
                document.getElementById("provinceDisplay").textContent = "Error generating data";
            }
        }

        // Wait for page to load before generating KTP
        window.addEventListener('load', function() {
            // Debug: Check if all required variables are loaded
            console.log('Page loaded, checking data...');
            console.log('indonesiaProvinces available:', typeof indonesiaProvinces !== 'undefined');
            console.log('userImages available:', typeof userImages !== 'undefined');
            console.log('getRandomProvince function:', typeof getRandomProvince !== 'undefined');
            
            // Add a small delay to ensure data.js is fully loaded
            setTimeout(function() {
                generateNewKTP();
            }, 100);
        });

        // Also try to generate immediately for fallback
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, attempting backup generation...');
            setTimeout(function() {
                if (document.getElementById("provinceDisplay").textContent === "Loading...") {
                    generateNewKTP();
                }
            }, 500);
        });

        //scale functionality
        {
            const ktp = document.getElementById("ktp");
            const scale = document.getElementById("scale");
            scale.addEventListener("input", function () {
                const scaleValue = scale.value;
                ktp.style.transform = `scale(${scaleValue})`;
            });
        }

    </script>
</body>
</html>
