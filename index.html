<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indonesia KTP Generator - Dynamic Provinces & Regencies</title>
  <script type='text/javascript' src='./data.js'></script>
  <style>
    @font-face {
      font-family: ocr;
      src: url(ocraextended.ttf);
    }

    html {
      box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    body {
      background-color: #a83232;
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .parentBox {
      flex-grow: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }

    .box {
      position: relative;
      width: 100%;
      max-width: 600px;
      aspect-ratio: 1 / 1;
      background-image: url("assets/ktp_template_region.jpg");
      background-repeat: no-repeat;
      background-size: cover;
      transform-origin: center;
    }

    input {
      position: absolute;
      background: transparent;
      border: none;
      font-family: Arial, sans-serif;
      font-size: calc(12px * (1vw + 0.5vh));
      font-weight: normal;
      text-transform: uppercase;
      transform: skew(0deg, -1.3deg);
      color: transparent;
      text-shadow: 0 0 1px rgba(0, 0, 0, 1);
      padding: 0;
      margin: 0;
    }

    .province, .regency, .nik {
      font-family: ocr;
      font-size: 18px;
      text-align: center;
      width: 40%;
    }

    .province { left: 31.6%; top: 27.5%; }
    .regency { left: 31.6%; top: 30%; }
    .nik { left: 30.3%; top: 34.5%; }
    .name { left: 36.6%; top: 38.8%; }
    .region { left: 36.6%; top: 41%; }
    .dob { left: 50%; top: 40.8%; }
    .jenis { left: 36.6%; top: 43.3%; }
    .golDarah { left: 65%; top: 42.8%; }
    .alamat { left: 36.6%; top: 45.5%; }
    .rt { left: 36.6%; top: 47.6%; }
    .kel { left: 36.6%; top: 50%; }
    .kec { left: 36.6%; top: 52.1%; }
    .agama { left: 36.6%; top: 54.3%; }
    .status { left: 36.6%; top: 56.3%; }
    .pek { left: 36.8%; top: 58.5%; }
    .kew { left: 36.8%; top: 60.8%; }
    .ber { left: 36.8%; top: 63%; }

    .photoContainer {
      position: absolute;
      display: flex;
      flex-direction: column;
      align-items: center;
      left: 70.3%;
      top: 35.8%;
      transform: skew(0deg, -1.3deg);
      width: 17.8%;
    }

    .profileimg {
      width: 100%;
      height: auto;
      aspect-ratio: 107 / 135;
      filter: blur(1px);
    }

    .scaleBox {
      position: fixed;
      right: 20px;
      top: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      width: 200px;
    }

    .scaleBox > input[type="range"] {
      width: 100%;
      position: static;
      transform: none;
      color: inherit;
      text-shadow: none;
    }

    .regenerateBtn {
      padding: 8px 15px;
      background: #1d86a4;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      font-size: 12px;
      transition: background 0.3s;
      width: 100%;
      margin-top: 5px;
    }

    .regenerateBtn:hover {
      background: #156a80;
    }

    .controlLabel {
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
      font-size: 14px;
      text-align: center;
    }

    .provinceInfo {
      position: fixed;
      left: 20px;
      top: 20px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      font-weight: bold;
      color: #333;
      max-width: 250px;
    }

    .provinceInfo .label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }

    .provinceInfo .value {
      font-size: 14px;
      color: #1d86a4;
      word-wrap: break-word;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      body {
        flex-direction: column;
      }
      .parentBox {
        order: 1;
        padding-bottom: 150px; /* Space for controls */
      }
      .provinceInfo, .scaleBox {
        position: fixed;
        bottom: 10px;
        top: auto;
        width: calc(50% - 15px);
      }
      .provinceInfo {
        left: 10px;
        right: auto;
      }
      .scaleBox {
        right: 10px;
        left: auto;
      }
      input { font-size: 1.8vw; }
      .province, .regency, .nik { font-size: 2.5vw; }
    }

    @media (max-width: 480px) {
      input { font-size: 2.5vw; }
      .province, .regency, .nik { font-size: 3.5vw; }
      .provinceInfo, .scaleBox {
        width: calc(50% - 10px);
      }
      .provinceInfo { left: 5px; }
      .scaleBox { right: 5px; }
    }
  </style>
</head>

<body>
<div class="parentBox">
  <div id="ktp" class="box">
    <div class="photoContainer">
      <img class="profileimg" src="" alt="Profile Photo">
      <div class="shrtdisc">
        <input type="text" class="region2" value="">
        <br>
        <input type="text" class="tem" value="">
      </div>
    </div>
    <input type="text" class="province" value="">
    <input type="text" class="regency" value="">
    <input type="text" class="nik" value="">
    <input type="text" class="name" value="">
    <input type="text" class="region">
    <input type="text" class="dob">
    <input type="text" class="jenis" value="">
    <input type="text" class="golDarah" value="">
    <input type="text" class="alamat" value="">
    <input type="text" class="rt" value="">
    <input type="text" class="kel" value="">
    <input type="text" class="kec" value="">
    <input type="text" class="agama" value="">
    <input type="text" class="status" value="">
    <input type="text" class="pek" value="">
    <input type="text" class="kew" value="">
    <input type="text" class="ber" value="">
  </div>
</div>
<div class="provinceInfo">
  <div class="label">Current Province & Regency:</div>
  <div class="value" id="provinceDisplay">Loading...</div>
</div>
<div class="scaleBox">
  <div class="controlLabel">Scale</div>
  <input type="range" id="scale" min="0.25" max="3" step="0.01" value="1">
  <button class="regenerateBtn" onclick="generateNewKTP()">Generate New KTP</button>
</div>
<script>
  function randomIntFromInterval(min, max) { // min and max included
    return Math.floor(Math.random() * (max - min + 1) + min);
  }

  function generateDOB() {
    const now = new Date();

    const maxDate = new Date(now.getFullYear() - 17, now.getMonth(), now.getDate());
    const minDate = new Date(now.getFullYear() - 78, now.getMonth(), now.getDate());

    // Ensure integer timestamp
    const randomTimestamp = Math.floor(Math.random() * (maxDate.getTime() - minDate.getTime()) + minDate.getTime());

    return new Date(randomTimestamp);
  }

  function generateNIK(gender, provinceCode, regencyCode) {
    const dobDate = generateDOB();
    const randomBirthYear = dobDate.getFullYear().toString().substr(-2).padStart(2, '0');
    const randomBirthMonth = (dobDate.getMonth() + 1).toString().padStart(2, '0');
    const randomBirthDay = (dobDate.getDate() + (gender === 'male' ? 0 : 40)).toString().padStart(2, '0');
    const randomSerialNumber = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
    const nik = `${provinceCode}${regencyCode}${randomBirthDay}${randomBirthMonth}${randomBirthYear}${randomSerialNumber}`;
    return { nik, dob: dobDate };
  }

  function generateKTP() {
    // Sample location map (you can expand as needed)
    const regionCodes = [
      { prov: "31", city: "73", district: "01" }, // Jakarta Selatan
      { prov: "32", city: "71", district: "05" }, // Bandung
      { prov: "36", city: "72", district: "02" }, // Tangerang
      { prov: "35", city: "78", district: "04" }, // Surabaya
      { prov: "33", city: "74", district: "03" }, // Semarang
    ];

    // Pick random region
    const region = regionCodes[Math.floor(Math.random() * regionCodes.length)];

    // Random gender (0 = Male, 1 = Female)
    const isFemale = Math.random() > 0.5;

    const dob = generateDOB();
    const day = dob.getDate();
    const month = (dob.getMonth() + 1).toString().padStart(2, "0");
    const year = dob.getFullYear().toString().slice(-2);

    // Apply +40 rule for females
    const ktpDay = (isFemale ? day + 40 : day).toString().padStart(2, "0");

    // Random last four digits (not zero padded beyond 4 digits)
    const serial = Math.floor(1 + Math.random() * 9999).toString().padStart(4, "0");

    const nik = `${region.prov}${region.city}${region.district}${ktpDay}${month}${year}${serial}`;

    return {
      nik,
      isFemale,
      dob: dob.toISOString().split("T")[0],
      lokasi: region
    };
  }

  function formatDate(date) {
    const day = date.getDate().toString().padStart(2, '0');
    const month = (date.getMonth() + 1).toString().padStart(2, '0');
    const year = date.getFullYear();
    return `${day}-${month}-${year}`;
  }

  function getRandomBloodType() {
    const bloodTypes = ['A', 'B', 'AB', 'O'];
    const rhesus = ['+', '-'];
    return bloodTypes[Math.floor(Math.random() * bloodTypes.length)] +
            rhesus[Math.floor(Math.random() * rhesus.length)];
  }

  function getRandomReligion() {
    const religions = ["ISLAM", "KRISTEN", "KATOLIK", "HINDU", "BUDDHA", "KHONGHUCU"];
    return religions[Math.floor(Math.random() * religions.length)];
  }

  function getRandomMaritalStatus() {
    const statuses = ["BELUM KAWIN", "KAWIN", "CERAI HIDUP", "CERAI MATI"];
    return statuses[Math.floor(Math.random() * statuses.length)];
  }

  function getRandomOccupation() {
    const occupations = [
      "PEGAWAI NEGERI SIPIL", "TNI", "POLRI", "PERDAGANGAN", "PETANI/PEKEBUN",
      "PETERNAK", "NELAYAN/PERIKANAN", "INDUSTRI", "KONSTRUKSI", "TRANSPORTASI",
      "KARYAWAN SWASTA", "KARYAWAN BUMN", "KARYAWAN BUMD", "KARYAWAN HONORER",
      "BURUH HARIAN LEPAS", "BURUH TANI/PERKEBUNAN", "BURUH NELAYAN/PERIKANAN",
      "BURUH PETERNAKAN", "PEMBANTU RUMAH TANGGA", "TUKANG CUKUR", "TUKANG LISTRIK",
      "TUKANG BATU", "TUKANG KAYU", "TUKANG SOL SEPATU", "TUKANG LAS/PANDAI BESI",
      "TUKANG JAHIT", "TUKANG GIGI", "PENATA RIAS", "PENATA BUSANA", "PENATA RAMBUT",
      "MEKANIK", "SENIMAN", "TABIB", "PARAJI", "PERANCANG BUSANA", "PENTERJEMAH",
      "IMAM MASJID", "PENDETA", "PASTOR", "WARTAWAN", "USTADZ/MUBALIGH", "JURU MASAK",
      "PROMOTOR ACARA", "ANGGOTA DPR-RI", "ANGGOTA DPD", "ANGGOTA BPK", "PRESIDEN",
      "WAKIL PRESIDEN", "ANGGOTA MAHKAMAH KONSTITUSI", "ANGGOTA KABINET KEMENTERIAN",
      "DUTA BESAR", "GUBERNUR", "WAKIL GUBERNUR", "BUPATI", "WAKIL BUPATI", "WALIKOTA",
      "WAKIL WALIKOTA", "ANGGOTA DPRD PROVINSI", "ANGGOTA DPRD KABUPATEN/KOTA",
      "DOSEN", "GURU", "PILOT", "PENGACARA", "NOTARIS", "ARSITEK", "AKUNTAN",
      "KONSULTAN", "DOKTER", "BIDAN", "PERAWAT", "APOTEKER", "PSIKIATER/PSIKOLOG",
      "PELAJAR/MAHASISWA", "MENGURUS RUMAH TANGGA", "SUDAH TIDAK BEKERJA", "BELUM/TIDAK BEKERJA"
    ];
    return occupations[Math.floor(Math.random() * occupations.length)];
  }

  // Generate random Indonesian data
  function generateNewKTP() {
    try {
      // Check if data is loaded
      if (typeof indonesiaProvinces === 'undefined' || typeof userImages === 'undefined' || typeof getRandomIndonesianName === 'undefined' || typeof getRandomIndonesianAddress === 'undefined' || typeof getRandomProvince === 'undefined' || typeof getRandomRegency === 'undefined') {
        console.error('Data or functions from data.js not loaded properly');
        document.getElementById("provinceDisplay").textContent = "Error: Data not loaded";
        return;
      }

      var selectedProvince = getRandomProvince();
      var selectedRegency = getRandomRegency(selectedProvince);

      var rndInt = randomIntFromInterval(0, userImages.length - 1);
      var singleUserSource = userImages[rndInt];
      var generatedData = generateNIK(singleUserSource.gender, selectedProvince.code, selectedRegency.code.replace('.', ''));
      var randomName = getRandomIndonesianName();
      var randomAddress = getRandomIndonesianAddress();

      // Update province display
      document.getElementById("provinceDisplay").textContent = `${selectedProvince.name} - ${selectedRegency.name}`;

      document.querySelector(".profileimg").src = `./${singleUserSource.source}`;
      document.querySelector(".nik").value = generateKTP().nik;
      document.querySelector(".name").value = randomName.toUpperCase();
      document.querySelector(".region").value = "SINGARAJA" + ",";
      document.querySelector(".dob").value = formatDate(generatedData.dob);
      document.querySelector(".jenis").value = singleUserSource.gender === "male" ? "LAKI-LAKI" : "PEREMPUAN";
      document.querySelector(".golDarah").value = getRandomBloodType();
      document.querySelector(".alamat").value = randomAddress.substring(0, 25).toUpperCase();
      document.querySelector(".rt").value = `${String(Math.floor(Math.random() * 20) + 1).padStart(3, '0')}/${String(Math.floor(Math.random() * 20) + 1).padStart(3, '0')}`;
      document.querySelector(".kel").value = selectedRegency.name.toUpperCase();
      document.querySelector(".kec").value = selectedRegency.name.toUpperCase();
      document.querySelector(".agama").value = getRandomReligion();
      document.querySelector(".status").value = getRandomMaritalStatus();
      document.querySelector(".pek").value = getRandomOccupation();
      document.querySelector(".kew").value = "WNI";
      document.querySelector(".ber").value = "SEUMUR HIDUP";

      document.querySelector(".province").value = selectedProvince.name.toUpperCase();
      document.querySelector(".regency").value = selectedRegency.name.toUpperCase();
    } catch (error) {
      console.error('Error generating KTP:', error);
      document.getElementById("provinceDisplay").textContent = "Error generating data";
    }
  }

  function setupApp() {
    if (typeof indonesiaProvinces !== 'undefined' && typeof userImages !== 'undefined') {
      generateNewKTP();
    } else {
      // Retry after a short delay if data isn't ready
      setTimeout(setupApp, 100);
    }
  }

  window.addEventListener('load', setupApp);

  //scale functionality
  const ktp = document.getElementById("ktp");
  const scale = document.getElementById("scale");
  scale.addEventListener("input", function () {
    ktp.style.transform = `scale(${this.value})`;
  });

  document.addEventListener('DOMContentLoaded', function() {
    const nikInput = document.querySelector('.nik');

    function removeDashes(value) {
      return value.replace(/-/g, '');
    }

    nikInput.addEventListener('input', function(e) {
      const cursorPosition = e.target.selectionStart;
      const originalValue = e.target.value;
      const cleanValue = removeDashes(originalValue);

      if (originalValue !== cleanValue) {
        e.target.value = cleanValue;
        const dashesRemoved = originalValue.length - cleanValue.length;
        e.target.setSelectionRange(cursorPosition - dashesRemoved, cursorPosition - dashesRemoved);
      }
    });

    nikInput.addEventListener('paste', function(e) {
      e.preventDefault();
      const pasteData = (e.clipboardData || window.clipboardData).getData('text');
      const cleanData = removeDashes(pasteData);

      const start = e.target.selectionStart;
      const end = e.target.selectionEnd;

      e.target.value = e.target.value.substring(0, start) + cleanData + e.target.value.substring(end);
      e.target.setSelectionRange(start + cleanData.length, start + cleanData.length);
    });
  });

</script>
</body>
</html>
